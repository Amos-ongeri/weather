(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function u(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(t){if(t.ep)return;t.ep=!0;const i=u(t);fetch(t.href,i)}})();const w="https://weather-server-side.onrender.com",A=async()=>{try{const e=await fetch(`${w}/api/geolocation`);if(!e.ok)throw new Error("an error occured");const o=await e.json();return console.log("geolocation: ",o),o}catch(e){console.log(e.message)}},R=async e=>{try{const o=await fetch(`${w}/api/weather?city=${e}`);o.ok||alert("something went wrong, please enter a valid city name");const u=await fetch(`${w}/api/forecast?city=${e}`);if(!u.ok)throw new Error("couldnt fetch data");const s=await u.json();console.log("forecast:",s);const t=await o.json();console.log("weather",t),N(t,s)}catch(o){console.log(o.message)}},H=async()=>{try{const e=await A();console.log("Calling: ",`${w}/api/current?lat=${e.latitude}&lon=${e.longitude}`);const o=await fetch(`${w}/api/current?lat=${e.latitude}&lon=${e.longitude}`);if(!o.ok)throw new Error("Failed to fetch weather");const u=await fetch(`${w}/api/forecast?city=${e.city}`);if(!u.ok)throw new Error("Failed to fetch weather");const s=await u.json();console.log("Current location forecast:",s);const t=await o.json();console.log("Current location weather:",t),N(t,s)}catch(e){console.log(e.message)}},f={Clouds:"clouds_new",CloudsClassic:"clouds",Precipitation:"precipitation_new",PrecipitationClassic:"precipitation",Pressure:"pressure_new",PressureClassic:"pressure",Wind:"wind_new",WindClassic:"wind",Temperature:"temp_new",TemperatureClassic:"temp",Snow:"snow"};let C={};const V=(e,o,u,s)=>{const t=e.id;C[t]?(C[t].data.labels=o,C[t].data.datasets[0].data=s,C[t].update()):C[t]=new Chart(e,{type:"bar",data:{labels:o,datasets:[{label:u,data:s,borderWidth:1,backgroundColor:"rgba(0,123,255,0.5)"}]},options:{responsive:!0,scales:{y:{beginAtZero:!0}}}})};let d,q;async function N(e,o=null){try{if(!d){let h=function(c,l){const m=document.createElement("div");m.className="legend",m.id="map-legend";const v=document.createElement("div");v.className="legend-title";const B=y[`${c}`]?y[`${c}`]:"";v.textContent=c+", "+B,m.appendChild(v);const E=document.createElement("div");E.className="legend-bar";let n="linear-gradient(to right, ";n+=l.map(([z,k],j)=>{const _=j/(l.length-1)*100;return`${k} ${_}%`}).join(", "),n+=")",E.style.background=n,m.appendChild(E);const x=document.createElement("div");x.className="legend-labels",l.forEach(([z])=>{const k=document.createElement("span");k.textContent=z,x.appendChild(k)}),m.appendChild(x),document.getElementById("legend").innerHTML="",document.getElementById("legend").appendChild(m),p=m};var u=h;d=L.map("weather-map",{center:[e.coord.lat,e.coord.lon],zoom:5,minZoom:2,maxZoom:18,maxBounds:[[-90,-180],[90,180]],worldCopyJump:!0}).setView([e.coord.lat,e.coord.lon],6),setTimeout(()=>{d.invalidateSize()},0),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(d);const a={Clouds:L.tileLayer(`/api/tiles/${f.CloudsClassic}/{z}/{x}/{y}`),Precipitation:L.tileLayer(`/api/tiles/${f.PrecipitationClassic}/{z}/{x}/{y}`),Temperature:L.tileLayer(`/api/tiles/${f.Temperature}/{z}/{x}/{y}`),Wind:L.tileLayer(`/api/tiles/${f.Wind}/{z}/{x}/{y}`),Pressure:L.tileLayer(`/api/tiles/${f.Pressure}/{z}/{x}/{y}`),Snow:L.tileLayer(`/api/tiles/${f.Snow}/{z}/{x}/{y}`)},r={Clouds:a.Clouds,Precipitation:a.Precipitation,Temperature:a.Temperature,Wind:a.Wind,Pressure:a.Pressure,Snow:a.Snow};L.control.layers(r,{}).addTo(d);const b={Precipitation:[[0,"rgba(225, 200, 100, 0)"],[.1,"rgba(200, 150, 150, 0)"],[.2,"rgba(150, 150, 170, 0)"],[.5,"rgba(120, 120, 190, 0)"],[1,"rgba(110, 110, 205, 0.3)"],[10,"rgba(80, 80, 225, 0.7)"],[140,"rgba(20, 20, 255, 0.9)"]],Snow:[[0,"transparent"],[5,"#00d8ff"],[10,"#00b6ff"],[25.076,"#9549ff"]],Clouds:[[0,"rgba(255,255,255,0.0)"],[50,"rgba(247,247,255,0.5)"],[100,"rgba(240,240,255,1)"]],Temperature:[[-65,"rgba(130,22,146,1)"],[-30,"rgba(130,87,219,1)"],[-20,"rgba(32,140,236,1)"],[-10,"rgba(32,196,232,1)"],[0,"rgba(35,221,221,1)"],[10,"rgba(194,255,40,1)"],[20,"rgba(255,240,40,1)"],[25,"rgba(255,194,40,1)"],[30,"rgba(252,128,20,1)"]],Wind:[[1,"rgba(255,255,255,0)"],[5,"rgba(238,206,206,0.4)"],[15,"rgba(179,100,188,0.7)"],[25,"rgba(63,33,59,0.8)"],[50,"rgba(116,76,172,0.9)"],[100,"rgba(70,0,175,1)"],[200,"rgba(13,17,38,1)"]],Pressure:[[94e3,"rgba(0,115,255,1)"],[1e5,"rgba(141,231,199,1)"],[101e3,"rgba(176,247,32,1)"],[104e3,"rgba(251,85,21,1)"],[108e3,"rgba(198,0,0,1)"]]},y={Temperature:"°C",Pressure:"hPa",Wind:"m/s",Precipitation:"mm/h",Clouds:"%",Snow:"mm/h"};let p=null;d.on("baselayerchange",c=>{for(let l in r)r[l]===c.layer&&b[l]&&(p&&p.remove(),h(l,b[l]))}),d.on("overlayremove",c=>{for(let l in r)r[l]===c.layer&&p&&(p.remove(),p=null)})}d.setView([e.coord.lat,e.coord.lon],6),q&&d.removeLayer(q);const s=`https://openweathermap.org/img/wn/${e.weather[0].icon}@2x.png`;if(q=L.marker([e.coord.lat,e.coord.lon],{icon:L.divIcon({className:"weather-label",html:`
            <div class="weather-box" onclick="toggleWeather(this)">
                <h3 class="weather-title">${e.name}, ${e.sys.country}</h3>

                <div class="weather-details">
                    <div style="display:flex; align-items:center;"><img style="width:60px" src=${s}> ${e.weather[0].description}</div>
                    temp: ${e.main.temp} &deg;C<br>
                    cloud cover: ${e.clouds.all}%<br>
                    Humidity: ${e.main.humidity}%<br>
                    Wind speed: ${(e.wind.speed*3.6).toFixed(1)}km/h<br>
                    pressure: ${e.main.pressure}hpa
                </div>
            </div>`,iconSize:null})}).addTo(d),o!==null){const a=document.querySelector(".forecastContainer");a.innerHTML="",o.list.forEach((r,b)=>{const y=`https://openweathermap.org/img/wn/${r.weather[0].icon}@2x.png`,p=new Date(r.dt*1e3),h={weekday:"short",hour:"2-digit",minute:"2-digit"},c=p.toLocaleString("en-US",h);a.innerHTML+=`
              <div class="forecastInfo">
                <p>${c}</p>
                <div style="display:flex; align-items:center; justify-content:start;">
                <img style="width: 65px; height: 65px;" src=${y}>
                <p>${r.weather[0].description}</p>
                </div>
                <div class='details'>
                  <p>temp: ${Math.floor(r.main.temp)}&deg;C</p>
                  <p>cloud cover: ${r.clouds.all}%</p>
                  <p>wind speed: ${(r.wind.speed*3.6).toFixed(1)} km/h</p>
                  <p>pressure: ${r.main.pressure} hpa</p>
                  <p>humidity: ${r.main.humidity}%</p>
                </div>
              </div>
            `})}const t=document.querySelector("#gps");if(t.replaceWith(t.cloneNode(!0)),document.querySelector("#gps").addEventListener("click",()=>{d.flyTo([e.coord.lat,e.coord.lon],8,{animate:!0,duration:2})}),o){const a=o.list.map(n=>new Date(n.dt*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),r=o.list.map(n=>n.clouds.all),b=o.list.map(n=>n.main.temp),y=o.list.map(n=>(n.wind.speed*3.6).toFixed(1)),p=o.list.map(n=>n.main.pressure),h=o.list.map(n=>n.main.humidity),c=document.getElementById("cloudCover"),l=document.getElementById("temp"),m=document.getElementById("wind"),v=document.getElementById("pressure"),B=document.getElementById("humidity");[{element:c,labels:a,label:"cloud cover (%)",data:r},{element:l,labels:a,label:"temperature (°C)",data:b},{element:m,labels:a,label:"wind speed (km/h)",data:y},{element:v,labels:a,label:"pressure (hpa)",data:p},{element:B,labels:a,label:"humidity (%)",data:h}].forEach(n=>V(n.element,n.labels,n.label,n.data))}}catch(s){console.error("Error:",s.message)}}const S=document.querySelector("#searchIcon"),M=document.querySelector("#searchComponent"),P=document.querySelector("#searchDiv");let $=!1,g=!1;const G=document.querySelector("#search"),Z=document.querySelector("#cancelIcon"),K=document.querySelector("#search"),J=document.querySelector("#searchBtn"),U=document.querySelector("#forecastDetails"),I=document.querySelector(".container"),W=document.querySelector("#Layer_1"),O=document.querySelector("#hold"),Y=document.querySelector("#terminateBtn"),T=document.querySelector("#mobile");function D(e){document.getElementById("loading").style.display=e?"block":"none"}const F=()=>{g?(W.style.transform="rotate(360deg)",I.style.display="none",T.style.animation="bounce 1s linear infinite",g=!g,console.log(g)):(W.style.transform="rotate(180deg)",I.style.display="block",T.style.animation="none",g=!g,console.log(g))},Q=()=>{J.addEventListener("click",async()=>{let e=K.value.trim();if(e){D(!0);try{await R(e)}catch(o){console.log(o.message)}finally{D(!1)}}else alert("please enter a city name!")})},X=()=>{G.value=""},ee=async()=>{$?(S.style.width="100%",S.style.height="100%",P.style.paddingLeft="0",M.style.display="none",setTimeout(()=>P.style.width="50px",10),$=!$):(P.style.width=window.innerWidth<=500?"65vw":window.innerWidth<=800?"50vw":"35vw",S.style.width="45px",S.style.height="45px",P.style.paddingLeft=".5%",setTimeout(()=>M.style.display="block",20),$=!$)};document.addEventListener("DOMContentLoaded",async()=>{U.addEventListener("click",F),T.addEventListener("click",F),Z.addEventListener("click",X),S.addEventListener("click",ee),Y.addEventListener("click",()=>{I.style.display="none",g=!g,W.style.transform="rotate(360deg)",T.style.animation="bounce 1s linear infinite"}),O.style.display="none",D(!0);try{await H(),O.style.display="block"}catch(e){console.error("Failed to load data:",e)}finally{D(!1)}Q()});
